import React, { createContext, useContext, useEffect, useState } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

const translations = {
  en: {
    common: {
      appName: 'QuizCraft',
      loading: 'Loading...',
      cancel: 'Cancel',
      save: 'Save',
      logout: 'Logout',
      create: 'Create',
      assign: 'Assign',
      language: 'Language',
      english: 'English',
      bangla: 'বাংলা',
      error: 'Error',
      success: 'Success',
      confirm: 'Confirm',
      delete: 'Delete',
      edit: 'Edit',
      back: 'Back',
      next: 'Next',
      submit: 'Submit',
      close: 'Close',
      yes: 'Yes',
      no: 'No',
      ok: 'OK',
    },
    home: {
      hello: 'Hello',
      ready: 'Ready to learn something new?',
      created: 'Created',
      completed: 'Completed',
      rank: 'Rank',
      exploreQuizzes: 'Explore Quizzes',
      noQuizzesTitle: 'No quizzes yet',
      noQuizzesText: 'Create your first quiz!',
      createQuiz: '+ Create Quiz',
      questions: 'Questions',
      views: 'Views',
      difficultyMixed: 'Mixed',
      testYourKnowledge: 'Test your knowledge',
      general: 'General',
    },
    upload: {
      generateQuiz: 'Generate Quiz',
      aiPowered: 'AI-Powered Quiz Creation',
      fromText: 'From Text',
      fromFile: 'From File',
      numQuestions: 'Number of Questions',
      chooseFile: 'Choose File',
      uploadAndGenerate: 'Upload & Generate',
      generate: 'Generate',
      enter100: 'Please enter at least 100 characters',
      success: 'Success!',
      textInput: 'Text Input',
      fileUpload: 'File Upload',
      difficultyLevel: 'Difficulty Level',
      easy: 'Easy',
      medium: 'Medium',
      hard: 'Hard',
      enterTextPlaceholder: 'Enter your text here (min 100 characters)...',
      fileSelected: 'File Selected',
      selectFile: 'Select File',
      pdfExtracted: 'PDF document selected - text will be extracted for quiz generation',
      imageExtracted: 'Image selected - text will be extracted using OCR for quiz generation',
      textFileExtracted: 'Text file selected - content will be used for quiz generation',
      wordExtracted: 'Word document selected - text will be extracted for quiz generation',
      fileExtracted: 'File selected - will attempt to extract content for quiz generation',
    },
    profile: {
      role: 'Role',
      logout: 'Logout',
      language: 'Language',
      teacherDashboard: 'Teacher Dashboard',
      adminDashboard: 'Admin Dashboard',
      appearance: 'Appearance',
      darkMode: 'Dark Mode',
      subscriptionAndBilling: 'Subscription & Billing',
      subscriptionPlans: 'Subscription Plans',
      manageSubscription: 'Manage your subscription',
      upgradeToPremium: 'Upgrade to premium',
      paymentHistory: 'Payment History',
      viewPayments: 'View your payments and invoices',
      roleFeatures: 'Role Features',
      manageClasses: 'Manage your classes and students',
      manageSystem: 'Manage users, quizzes, and system settings',
      joinClasses: 'Join Classes',
      joinWithCode: 'Join teacher classes with codes',
      becomeTeacher: 'Become a Teacher',
      requestUpgrade: 'Request upgrade to teacher account',
      accountSettings: 'Account & Settings',
      quizHistory: 'Quiz History',
      viewAttempts: 'View all your quiz attempts',
      myStatistics: 'My Statistics',
      viewAnalytics: 'View your performance analytics',
      myQuizzes: 'My Quizzes',
      manageQuizzes: 'View and manage your created quizzes',
      confirmLogout: 'Confirm Logout',
      areYouSure: 'Are you sure you want to logout?',
      requestRoleUpgrade: 'Request Role Upgrade',
      requestUpgradeMessage: 'Would you like to request an upgrade to {role} role? This will require admin approval.',
      requestSubmitted: 'Request Submitted',
      upgradeRequestSubmitted: 'Your {role} role upgrade request has been submitted. An admin will review it shortly.',
      failedToSubmit: 'Failed to submit role upgrade request',
      upgradeLabel: 'Upgrade',
      adminLabel: 'Admin',
      teacherLabel: 'Teacher',
      lightDark: 'Light/Dark',
    },
    teacher: {
      myClasses: 'My Classes',
      createClass: 'Create Class',
      className: 'Class Name',
      joinCode: 'Join Code',
      create: 'Create',
      assignToClass: 'Assign to Class',
      joinClass: 'Join Class',
      classDetails: 'Class Details',
      students: 'Students',
      assignedQuizzes: 'Assigned Quizzes',
    },
    login: {
      title: 'Welcome Back',
      subtitle: 'Sign in to continue',
      email: 'Email',
      password: 'Password',
      signIn: 'Login',
      continueGuest: 'Continue as Guest',
      prompt: "Don't have an account?",
      signup: 'Sign Up',
      fullName: 'Full Name',
      confirmPassword: 'Confirm Password',
      joinToday: 'Join QuizCraft today',
      iAmA: 'I am a:',
      student: 'Student',
      teacher: 'Teacher',
      alreadyHaveAccount: 'Already have an account?',
      forgotPassword: 'Forgot your password?',
      emailNotVerified: 'Email Not Verified',
      verifyEmailMessage: 'Please verify your email before logging in. Tap OK to go to verification.',
      loginFailed: 'Login Failed',
      testCredentials: 'Test Credentials:',
      enterEmailPassword: 'Please enter email and password',
      guestAccessFailed: 'Guest access failed',
    },
    quiz: {
      start: 'Start Quiz',
      assign: 'Assign to Class',
      share: 'Share',
      category: 'Category',
      difficulty: 'Difficulty',
      questions: 'Questions',
      quizDetails: 'Quiz Details',
      results: 'Results',
      myQuizzes: 'My Quizzes',
      takeQuiz: 'Take Quiz',
    },
    subscription: {
      title: 'Subscription',
      current: 'Current',
      premium: 'Premium',
      institutional: 'Institutional',
      upgrade: 'Upgrade',
    },
    analytics: {
      history: 'History',
      stats: 'My Statistics',
      leaderboard: 'Leaderboard',
      score: 'Score',
      attempts: 'Attempts',
      avgScore: 'Average Score',
      passRate: 'Pass Rate',
      averageTime: 'Average Time',
    },
    admin: {
      users: 'Users',
      quizzes: 'Quizzes',
      activity: 'Activity',
      search: 'Search',
      role: 'Role',
      status: 'Status',
      page: 'Page',
      next: 'Next',
      prev: 'Prev',
      filter: 'Filter',
      name: 'Name',
      email: 'Email',
      createdAt: 'Created',
      public: 'Public',
      from: 'From',
      to: 'To',
      subscription: 'Subscription',
      isActive: 'Active',
      title: 'Title',
      dashboard: 'Admin Dashboard',
      userManagement: 'User Management',
      quizManagement: 'Quiz Management',
      paymentManagement: 'Payment Management',
      systemSettings: 'System Settings',
    },
  },
  bn: {
    common: {
      appName: 'কুইজক্রাফ্ট',
      loading: 'লোড হচ্ছে...',
      cancel: 'বাতিল',
      save: 'সংরক্ষণ',
      logout: 'লগ আউট',
      create: 'তৈরি করুন',
      assign: 'বরাদ্দ দিন',
      language: 'ভাষা',
      english: 'English',
      bangla: 'বাংলা',
      error: 'ত্রুটি',
      success: 'সফল',
      confirm: 'নিশ্চিত করুন',
      delete: 'মুছুন',
      edit: 'সম্পাদনা',
      back: 'ফিরে যান',
      next: 'পরবর্তী',
      submit: 'জমা দিন',
      close: 'বন্ধ করুন',
      yes: 'হ্যাঁ',
      no: 'না',
      ok: 'ঠিক আছে',
    },
    home: {
      hello: 'স্বাগতম',
      ready: 'নতুন কিছু শিখতে প্রস্তুত?',
      created: 'তৈরি',
      completed: 'সম্পন্ন',
      rank: 'র‍্যাংক',
      exploreQuizzes: 'কুইজসমূহ দেখুন',
      noQuizzesTitle: 'এখনও কোন কুইজ নেই',
      noQuizzesText: 'আপনার প্রথম কুইজটি তৈরি করুন!',
      createQuiz: '+ কুইজ তৈরি করুন',
      questions: 'প্রশ্ন',
      views: 'ভিউ',
      difficultyMixed: 'মিশ্র',
      testYourKnowledge: 'আপনার জ্ঞান পরীক্ষা করুন',
      general: 'সাধারণ',
    },
    upload: {
      generateQuiz: 'কুইজ তৈরি করুন',
      aiPowered: 'এআই দ্বারা কুইজ প্রস্তুত',
      fromText: 'টেক্সট থেকে',
      fromFile: 'ফাইল থেকে',
      numQuestions: 'প্রশ্নের সংখ্যা',
      chooseFile: 'ফাইল বাছাই করুন',
      uploadAndGenerate: 'আপলোড ও তৈরি করুন',
      generate: 'তৈরি করুন',
      enter100: 'অনুগ্রহ করে কমপক্ষে ১০০ অক্ষর লিখুন',
      success: 'সফল!',
      textInput: 'টেক্সট ইনপুট',
      fileUpload: 'ফাইল আপলোড',
      difficultyLevel: 'কঠিনতার স্তর',
      easy: 'সহজ',
      medium: 'মাধ্যম',
      hard: 'কঠিন',
      enterTextPlaceholder: 'আপনার টেক্সট এখানে লিখুন (ন্যূনতম ১০০ অক্ষর)...',
      fileSelected: 'ফাইল নির্বাচিত',
      selectFile: 'ফাইল নির্বাচন করুন',
      pdfExtracted: 'পিডিএফ ডকুমেন্ট নির্বাচিত - কুইজ তৈরির জন্য টেক্সট বের করা হবে',
      imageExtracted: 'ছবি নির্বাচিত - ওসিআর ব্যবহার করে টেক্সট বের করা হবে',
      textFileExtracted: 'টেক্সট ফাইল নির্বাচিত - কুইজ তৈরির জন্য বিষয়বস্তু ব্যবহার করা হবে',
      wordExtracted: 'ওয়ার্ড ডকুমেন্ট নির্বাচিত - টেক্সট বের করা হবে',
      fileExtracted: 'ফাইল নির্বাচিত - বিষয়বস্তু বের করার চেষ্টা করা হবে',
    },
    profile: {
      role: 'ভূমিকা',
      logout: 'লগ আউট',
      language: 'ভাষা',
      teacherDashboard: 'শিক্ষক ড্যাশবোর্ড',
      adminDashboard: 'অ্যাডমিন ড্যাশবোর্ড',
      appearance: 'চেহারা',
      darkMode: 'ডার্ক মোড',
      subscriptionAndBilling: 'সাবস্ক্রিপশন এবং বিলিং',
      subscriptionPlans: 'সাবস্ক্রিপশন প্ল্যান',
      manageSubscription: 'আপনার সাবস্ক্রিপশন পরিচালনা করুন',
      upgradeToPremium: 'প্রিমিয়ামে আপগ্রেড করুন',
      paymentHistory: 'পেমেন্ট ইতিহাস',
      viewPayments: 'আপনার পেমেন্ট এবং চালান দেখুন',
      roleFeatures: 'ভূমিকার বৈশিষ্ট্য',
      manageClasses: 'আপনার ক্লাস এবং শিক্ষার্থী পরিচালনা করুন',
      manageSystem: 'ব্যবহারকারী, কুইজ এবং সিস্টেম সেটিংস পরিচালনা করুন',
      joinClasses: 'ক্লাসে যোগ দিন',
      joinWithCode: 'কোড দিয়ে শিক্ষকের ক্লাসে যোগ দিন',
      becomeTeacher: 'শিক্ষক হন',
      requestUpgrade: 'শিক্ষক অ্যাকাউন্টে আপগ্রেডের অনুরোধ করুন',
      accountSettings: 'অ্যাকাউন্ট এবং সেটিংস',
      quizHistory: 'কুইজ ইতিহাস',
      viewAttempts: 'আপনার সকল কুইজ প্রচেষ্টা দেখুন',
      myStatistics: 'আমার পরিসংখ্যান',
      viewAnalytics: 'আপনার পারফরম্যান্স বিশ্লেষণ দেখুন',
      myQuizzes: 'আমার কুইজ',
      manageQuizzes: 'আপনার তৈরি কুইজ দেখুন এবং পরিচালনা করুন',
      confirmLogout: 'লগ আউট নিশ্চিত করুন',
      areYouSure: 'আপনি কি নিশ্চিত যে লগ আউট করতে চান?',
      requestRoleUpgrade: 'ভূমিকা আপগ্রেডের অনুরোধ',
      requestUpgradeMessage: 'আপনি কি {role} ভূমিকায় আপগ্রেডের অনুরোধ করতে চান? এর জন্য অ্যাডমিনের অনুমোদন প্রয়োজন।',
      requestSubmitted: 'অনুরোধ জমা দেওয়া হয়েছে',
      upgradeRequestSubmitted: 'আপনার {role} ভূমিকা আপগ্রেডের অনুরোধ জমা দেওয়া হয়েছে। একজন অ্যাডমিন শীঘ্রই এটি পর্যালোচনা করবেন।',
      failedToSubmit: 'ভূমিকা আপগ্রেডের অনুরোধ জমা দিতে ব্যর্থ',
      upgradeLabel: 'আপগ্রেড',
      adminLabel: 'অ্যাডমিন',
      teacherLabel: 'শিক্ষক',
      lightDark: 'লাইট/ডার্ক',
    },
    teacher: {
      myClasses: 'আমার ক্লাসসমূহ',
      createClass: 'ক্লাস তৈরি করুন',
      className: 'ক্লাসের নাম',
      joinCode: 'জয়েন কোড',
      create: 'তৈরি করুন',
      assignToClass: 'ক্লাসে বরাদ্দ দিন',
      joinClass: 'ক্লাসে যোগ দিন',
      classDetails: 'ক্লাসের বিবরণ',
      students: 'শিক্ষার্থীরা',
      assignedQuizzes: 'বরাদ্দকৃত কুইজ',
    },
    login: {
      title: 'পুনরায় স্বাগতম',
      subtitle: 'চালিয়ে যেতে সাইন ইন করুন',
      email: 'ইমেইল',
      password: 'পাসওয়ার্ড',
      signIn: 'লগইন',
      continueGuest: 'গেস্ট হিসেবে চালিয়ে যান',
      prompt: 'অ্যাকাউন্ট নেই? ',
      signup: 'সাইন আপ',
      fullName: 'পূর্ণ নাম',
      confirmPassword: 'পাসওয়ার্ড নিশ্চিত করুন',
      joinToday: 'আজই কুইজক্রাফ্টে যোগ দিন',
      iAmA: 'আমি একজন:',
      student: 'ছাত্র/ছাত্রী',
      teacher: 'শিক্ষক',
      alreadyHaveAccount: 'ইতিমধ্যে অ্যাকাউন্ট আছে?',
      forgotPassword: 'পাসওয়ার্ড ভুলে গেছেন?',
      emailNotVerified: 'ইমেইল যাচাই করা হয়নি',
      verifyEmailMessage: 'লগইন করার আগে অনুগ্রহ করে আপনার ইমেইল যাচাই করুন। যাচাইকরণে যেতে OK চাপুন।',
      loginFailed: 'লগইন ব্যর্থ হয়েছে',
      testCredentials: 'টেস্ট শংসাপত্র:',
      enterEmailPassword: 'অনুগ্রহ করে ইমেইল এবং পাসওয়ার্ড লিখুন',
      guestAccessFailed: 'গেস্ট অ্যাক্সেস ব্যর্থ হয়েছে',
    },
    quiz: {
      start: 'কুইজ শুরু করুন',
      assign: 'ক্লাসে বরাদ্দ দিন',
      share: 'শেয়ার',
      category: 'বিভাগ',
      difficulty: 'কঠিনতা',
      questions: 'প্রশ্ন',
      quizDetails: 'কুইজ বিবরণ',
      results: 'ফলাফল',
      myQuizzes: 'আমার কুইজ',
      takeQuiz: 'কুইজ নিন',
    },
    subscription: {
      title: 'সাবস্ক্রিপশন',
      current: 'বর্তমান',
      premium: 'প্রিমিয়াম',
      institutional: 'ইনস্টিটিউশনাল',
      upgrade: 'আপগ্রেড',
    },
    analytics: {
      history: 'ইতিহাস',
      stats: 'আমার পরিসংখ্যান',
      leaderboard: 'লিডারবোর্ড',
      score: 'স্কোর',
      attempts: 'চেষ্টা',
      avgScore: 'গড় স্কোর',
      passRate: 'পাস হার',
      averageTime: 'গড় সময়',
    },
    admin: {
      users: 'ব্যবহারকারীরা',
      quizzes: 'কুইজসমূহ',
      activity: 'সক্রিয়তা',
      search: 'খোঁজ',
      role: 'ভূমিকা',
      status: 'অবস্থা',
      page: 'পৃষ্ঠা',
      next: 'পরবর্তী',
      prev: 'পূর্ববর্তী',
      filter: 'ফিল্টার',
      name: 'নাম',
      email: 'ইমেইল',
      createdAt: 'তৈরির তারিখ',
      public: 'পাবলিক',
      from: 'শুরু',
      to: 'শেষ',
      subscription: 'সাবস্ক্রিপশন',
      isActive: 'সক্রিয়',
      title: 'শিরোনাম',
      dashboard: 'অ্যাডমিন ড্যাশবোর্ড',
      userManagement: 'ব্যবহারকারী ব্যবস্থাপনা',
      quizManagement: 'কুইজ ব্যবস্থাপনা',
      paymentManagement: 'পেমেন্ট ব্যবস্থাপনা',
      systemSettings: 'সিস্টেম সেটিংস',
    },
  }
};

const I18nContext = createContext({ t: (k)=>k, lang: 'en', setLang: ()=>{} });
export const useI18n = () => useContext(I18nContext);

export const I18nProvider = ({ children }) => {
  const [lang, setLangState] = useState('en');

  useEffect(() => {
    (async () => {
      const saved = await AsyncStorage.getItem('lang');
      if (saved) setLangState(saved);
    })();
  }, []);

  const setLang = async (l) => {
    setLangState(l);
    await AsyncStorage.setItem('lang', l);
  };

  const t = (key) => {
    const [ns, k] = key.includes(':') ? key.split(':') : ['common', key];
    return translations[lang]?.[ns]?.[k] || translations.en?.[ns]?.[k] || key;
  };

  return (
    <I18nContext.Provider value={{ t, lang, setLang }}>
      {children}
    </I18nContext.Provider>
  );
};
